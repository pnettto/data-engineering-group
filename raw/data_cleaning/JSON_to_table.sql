INSERT INTO edg.prep.SCOTLAND_ENERGY_FLATTENED
SELECT
  value:month::STRING AS month,
  value:total_generation_gwh::INT,
  value:energy_sources.gas.gwh::INT,
  value:energy_sources.gas.percent::FLOAT,
  value:energy_sources.gas.emissions_per_gwh::INT,
  value:energy_sources.gas.co2_emissions_tons::INT,
  value:energy_sources.nuclear.gwh::INT,
  value:energy_sources.nuclear.percent::FLOAT,
  value:energy_sources.nuclear.emissions_per_gwh::INT,
  value:energy_sources.nuclear.co2_emissions_tons::INT,
  value:energy_sources.wind.gwh::INT,
  value:energy_sources.wind.percent::FLOAT,
  value:energy_sources.wind.emissions_per_gwh::INT,
  value:energy_sources.wind.co2_emissions_tons::INT,
  value:energy_sources.solar.gwh::INT,
  value:energy_sources.solar.percent::FLOAT,
  value:energy_sources.solar.emissions_per_gwh::INT,
  value:energy_sources.solar.co2_emissions_tons::INT,
  value:energy_sources.biomass.gwh::INT,
  value:energy_sources.biomass.percent::FLOAT,
  value:energy_sources.biomass.emissions_per_gwh::INT,
  value:energy_sources.biomass.co2_emissions_tons::INT,
  value:energy_sources.hydro.gwh::INT,
  value:energy_sources.hydro.percent::FLOAT,
  value:energy_sources.hydro.emissions_per_gwh::INT,
  value:energy_sources.hydro.co2_emissions_tons::INT,
  value:energy_sources.coal.gwh::INT,
  value:energy_sources.coal.percent::FLOAT,
  value:energy_sources.coal.emissions_per_gwh::INT,
  value:energy_sources.coal.co2_emissions_tons::INT,
  value:energy_sources.imports.gwh::INT,
  value:energy_sources.imports.percent::FLOAT,
  value:energy_sources.imports.emissions_per_gwh::INT,
  value:energy_sources.imports.co2_emissions_tons::INT
FROM edg.raw.SCOTLAND_ENERGY_TABLE,
LATERAL FLATTEN(input => raw:scotland_national_grid_energy_2024);